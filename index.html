<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCKY PINKY - GoldoraX Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        /* สไตล์เดิมจาก luckyapp.html */
        body { font-family: 'Kanit', sans-serif; background-color: #ffeef2; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        .header { background-color: #ff85a2; color: white; width: 100%; padding: 15px 0; text-align: center; font-size: 24px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .balance-container { background: white; border-radius: 15px; padding: 10px 20px; margin: 20px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 10px; }
        .balance-label { color: #ff85a2; font-weight: bold; }
        .balance-amount { font-size: 20px; color: #333; }
        
        /* ปรับขนาดรูปสัตว์ให้ใหญ่ขึ้นตามที่คุณต้องการ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 90%; max-width: 400px; margin-bottom: 20px; }
        .item { background: white; border-radius: 20px; padding: 15px 5px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; border: 3px solid transparent; height: 130px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .item img { width: 95%; height: auto; object-fit: contain; transform: scale(1.25); margin-bottom: 5px; } /* ขยายรูปให้ใหญ่และซูม */
        .item.selected { border-color: #ff85a2; background-color: #fff0f3; transform: scale(1.05); }
        .bet-badge { position: absolute; top: 5px; right: 5px; background: #ff85a2; color: white; border-radius: 50%; width: 25px; height: 25px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        .controls { width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px; }
        .bet-input-group { display: flex; align-items: center; gap: 10px; background: white; padding: 10px; border-radius: 15px; }
        input[type="number"] { flex: 1; border: none; outline: none; font-size: 16px; padding: 5px; }
        button { background-color: #ff85a2; color: white; border: none; padding: 15px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #ff6b8d; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 80%; max-width: 300px; text-align: center; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="header">LUCKY PINKY</div>

    <div class="balance-container">
        <span class="balance-label">ยอดเงิน:</span>
        <span class="balance-amount" id="balanceDisplay">0</span>
        <span id="userTag" style="font-size: 12px; color: #aaa; margin-left: 10px;"></span>
    </div>

    <div class="grid" id="gameGrid">
        <div class="item" onclick="selectItem('tiger')">
            <img src="tiger.png" alt="Tiger">
            <div id="bet-tiger" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="selectItem('rooster')">
            <img src="rooster.png" alt="Rooster">
            <div id="bet-rooster" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="selectItem('shrimp')">
            <img src="shrimp.png" alt="Shrimp">
            <div id="bet-shrimp" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="selectItem('crab')">
            <img src="crab.png" alt="Crab">
            <div id="bet-crab" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="selectItem('fish')">
            <img src="fish.png" alt="Fish">
            <div id="bet-fish" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="selectItem('gourd')">
            <img src="gourd.png" alt="Gourd">
            <div id="bet-gourd" class="bet-badge" style="display:none">0</div>
        </div>
    </div>

    <div class="controls">
        <div class="bet-input-group">
            <span>เดิมพัน:</span>
            <input type="number" id="betInput" value="10" min="1">
        </div>
        <button id="spinBtn" onclick="spin()">เริ่มสุ่ม!</button>
        <button style="background:#aaa; margin-top:10px; font-size:14px;" onclick="logout()">ออกจากระบบ</button>
    </div>

    <div id="loginModal" class="modal" style="display:flex;">
        <div class="modal-content">
            <h3>เข้าสู่ระบบ</h3>
            <input type="text" id="usernameInput" placeholder="ชื่อผู้ใช้">
            <input type="password" id="passwordInput" placeholder="รหัสผ่าน">
            <button onclick="handleAuth()" style="width:100%;">ตกลง</button>
        </div>
    </div>

    <script>
        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
            authDomain: "goldorax-game.firebaseapp.com",
            databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "goldorax-game",
            storageBucket: "goldorax-game.firebasestorage.app",
            messagingSenderId: "601999451419",
            appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
            measurementId: "G-09PW99QK06"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUser = null;
        let bets = {};

        // --- Auth & Data Functions ---
        function handleAuth() {
            const user = document.getElementById('usernameInput').value;
            if(!user) return alert("กรุณาใส่ชื่อ");
            
            currentUser = user;
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('userTag').innerText = "@" + user;
            
            // ดึงข้อมูลจาก Firebase
            database.ref('goldorax/lucky_pinky/users/' + currentUser).once('value').then((snapshot) => {
                const data = snapshot.val();
                if(data) {
                    syncBalance(data.balance);
                } else {
                    // ถ้าเป็น User ใหม่ ให้เริ่มที่ 1000
                    updateDBBalance(1000);
                }
            });
        }

        function updateDBBalance(newAmt) {
            if(currentUser) {
                database.ref('goldorax/lucky_pinky/users/' + currentUser).update({
                    balance: newAmt,
                    lastUpdate: firebase.database.ServerValue.TIMESTAMP
                });
            }
            syncBalance(newAmt);
        }

        function syncBalance(amt) {
            document.getElementById('balanceDisplay').innerText = amt.toLocaleString();
            // เก็บลง LocalStorage สำรองไว้ด้วย
            localStorage.setItem('currentBalance', amt);
        }

        function getBalance() {
            return parseInt(document.getElementById('balanceDisplay').innerText.replace(/,/g, '')) || 0;
        }

        // --- Game Logic ---
        function selectItem(item) {
            const betAmt = parseInt(document.getElementById('betInput').value);
            const currentBal = getBalance();
            if(betAmt > currentBal) return alert("เงินไม่พอ!");

            bets[item] = (bets[item] || 0) + betAmt;
            updateDBBalance(currentBal - betAmt);
            
            const badge = document.getElementById('bet-' + item);
            badge.innerText = bets[item];
            badge.style.display = 'flex';
        }

        function spin() {
            const items = ['tiger', 'rooster', 'shrimp', 'crab', 'fish', 'gourd'];
            if(Object.keys(bets).length === 0) return alert("กรุณาวางเดิมพันก่อน!");

            document.getElementById('spinBtn').disabled = true;
            
            setTimeout(() => {
                const result = items[Math.floor(Math.random() * items.length)];
                let winAmt = 0;

                if(bets[result]) {
                    winAmt = bets[result] * 6; // ชนะได้ 6 เท่า
                    alert("ยินดีด้วย! ออก " + result + " คุณได้รับ " + winAmt);
                } else {
                    alert("เสียใจด้วย! ออก " + result);
                }

                updateDBBalance(getBalance() + winAmt);
                resetBets();
                document.getElementById('spinBtn').disabled = false;
            }, 1000);
        }

        function resetBets() {
            bets = {};
            const badges = document.querySelectorAll('.bet-badge');
            badges.forEach(b => { b.style.display = 'none'; b.innerText = '0'; });
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
</html>
