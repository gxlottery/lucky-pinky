<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCKY PINKY - GoldoraX Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root { --main-pink: #ff85a2; --light-pink: #ffeef2; --dark-pink: #ff6b8d; --white: #ffffff; }
        body { font-family: 'Kanit', sans-serif; background-color: var(--light-pink); margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding-bottom: 50px; }
        .header { background-color: var(--main-pink); color: white; width: 100%; padding: 15px 0; text-align: center; font-size: 24px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .balance-container { background: white; border-radius: 20px; padding: 15px 25px; margin: 20px 0; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; border: 2px solid var(--main-pink); }
        .balance-label { color: var(--main-pink); font-weight: 600; font-size: 18px; }
        .balance-amount { font-size: 24px; color: #333; font-weight: bold; }
        
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 95%; max-width: 450px; margin-bottom: 20px; }
        .item { background: white; border-radius: 20px; padding: 10px 5px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; border: 3px solid transparent; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        /* ปรับขนาดรูปสัตว์ให้ใหญ่เต็มปุ่มตามที่คุณต้องการ */
        .item img { width: 90%; height: auto; object-fit: contain; transform: scale(1.3); transition: transform 0.3s; margin-bottom: 5px; }
        .item:active { transform: scale(0.95); }
        .item.selected { border-color: var(--main-pink); background-color: #fff0f3; box-shadow: 0 0 15px rgba(255, 133, 162, 0.3); }
        
        .bet-badge { position: absolute; top: 8px; right: 8px; background: var(--main-pink); color: white; border-radius: 12px; padding: 2px 8px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .controls { width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 12px; }
        .bet-input-group { display: flex; align-items: center; gap: 10px; background: white; padding: 12px 20px; border-radius: 15px; border: 1px solid #eee; }
        input[type="number"] { flex: 1; border: none; outline: none; font-size: 18px; padding: 5px; font-family: 'Kanit'; font-weight: bold; color: var(--main-pink); }
        
        .btn-main { background-color: var(--main-pink); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 133, 162, 0.3); transition: all 0.2s; }
        .btn-main:hover { background-color: var(--dark-pink); transform: translateY(-2px); }
        .btn-main:active { transform: translateY(0); }
        .btn-main:disabled { background-color: #ccc; box-shadow: none; transform: none; }

        /* Modal Styles */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-content { background: white; padding: 30px; border-radius: 25px; width: 100%; max-width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        input[type="text"], input[type="password"] { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #eee; border-radius: 12px; font-family: 'Kanit'; font-size: 16px; box-sizing: border-box; background: #f9f9f9; }
        
        /* Admin Section */
        #adminPanel { margin-top: 20px; display: none; width: 90%; max-width: 400px; background: #fff; padding: 20px; border-radius: 20px; border: 2px dashed var(--main-pink); }
    </style>
</head>
<body>

    <div class="header">LUCKY PINKY</div>

    <div class="balance-container">
        <span class="balance-label">ยอดเงิน:</span>
        <span class="balance-amount" id="balanceDisplay">0</span>
        <span id="userDisplay" style="margin-left:auto; font-size:14px; color:#888;"></span>
    </div>

    <div class="grid">
        <div class="item" onclick="placeBet('tiger')">
            <img src="tiger.png" alt="Tiger">
            <div id="badge-tiger" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="placeBet('rooster')">
            <img src="rooster.png" alt="Rooster">
            <div id="badge-rooster" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="placeBet('shrimp')">
            <img src="shrimp.png" alt="Shrimp">
            <div id="badge-shrimp" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="placeBet('crab')">
            <img src="crab.png" alt="Crab">
            <div id="badge-crab" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="placeBet('fish')">
            <img src="fish.png" alt="Fish">
            <div id="badge-fish" class="bet-badge" style="display:none">0</div>
        </div>
        <div class="item" onclick="placeBet('gourd')">
            <img src="gourd.png" alt="Gourd">
            <div id="badge-gourd" class="bet-badge" style="display:none">0</div>
        </div>
    </div>

    <div class="controls">
        <div class="bet-input-group">
            <span style="font-weight:bold; color:#666;">จำนวนเดิมพัน:</span>
            <input type="number" id="betInput" value="10" min="1">
        </div>
        <button id="spinBtn" class="btn-main" onclick="playGame()">หมุนเลย!</button>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="logout()" style="flex:1; background:#eee; color:#666; border:none; padding:10px; border-radius:10px; cursor:pointer;">ออกจากระบบ</button>
            <button onclick="toggleAdmin()" style="flex:1; background:#eee; color:#666; border:none; padding:10px; border-radius:10px; cursor:pointer;">Admin</button>
        </div>
    </div>

    <div id="adminPanel">
        <h4 style="margin:0 0 10px 0;">ตั้งค่า Admin</h4>
        <input type="number" id="adminBalanceInput" placeholder="จำนวนเงิน">
        <button onclick="adminSetBalance()" class="btn-main" style="width:100%; padding:10px; font-size:16px;">ปรับยอดเงิน</button>
    </div>

    <div id="loginModal" class="modal" style="display:flex;">
        <div class="modal-content">
            <h2 style="color:var(--main-pink); margin-top:0;">LUCKY PINKY</h2>
            <p>กรุณาลงชื่อเข้าใช้งาน</p>
            <input type="text" id="usernameInput" placeholder="ชื่อผู้ใช้">
            <input type="password" id="passwordInput" placeholder="รหัสผ่าน">
            <button onclick="handleAuth()" class="btn-main" style="width:100%;">เข้าสู่ระบบ</button>
        </div>
    </div>

    <script>
        // --- 1. Firebase Configuration (GoldoraX-Game) ---
        const firebaseConfig = {
            apiKey: "AIzaSyACTSU6LYObSv5gEAfKJt4Yr4LaCCAkQvw",
            authDomain: "goldorax-game.firebaseapp.com",
            databaseURL: "https://goldorax-game-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "goldorax-game",
            storageBucket: "goldorax-game.firebasestorage.app",
            messagingSenderId: "601999451419",
            appId: "1:601999451419:web:f0782a8437b493eb8f5fbe",
            measurementId: "G-09PW99QK06"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentUser = null;
        let currentBets = {};

        // --- 2. Auth & Core Data Functions ---
        function handleAuth() {
            const user = document.getElementById('usernameInput').value.trim();
            const pass = document.getElementById('passwordInput').value;
            if(!user || !pass) return alert("กรุณากรอกข้อมูลให้ครบ");

            currentUser = user;
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('userDisplay').innerText = user;

            // ดึงข้อมูลจาก Firebase
            database.ref('goldorax/lucky_pinky/users/' + user).once('value').then((snapshot) => {
                const data = snapshot.val();
                if(data) {
                    updateUI(data.balance);
                } else {
                    // ผู้เล่นใหม่
                    saveToFirebase(1000);
                }
            });
        }

        function saveToFirebase(newBalance) {
            if(!currentUser) return;
            database.ref('goldorax/lucky_pinky/users/' + currentUser).update({
                balance: newBalance,
                lastUpdate: firebase.database.ServerValue.TIMESTAMP
            });
            updateUI(newBalance);
        }

        function updateUI(balance) {
            document.getElementById('balanceDisplay').innerText = balance.toLocaleString();
        }

        function getCurrentBalance() {
            return parseInt(document.getElementById('balanceDisplay').innerText.replace(/,/g, '')) || 0;
        }

        // --- 3. Game Logic ---
        function placeBet(animal) {
            const amount = parseInt(document.getElementById('betInput').value);
            const balance = getCurrentBalance();

            if(amount > balance) return alert("ยอดเงินไม่เพียงพอ!");
            if(amount <= 0) return alert("กรุณาใส่จำนวนเงินที่ถูกต้อง");

            currentBets[animal] = (currentBets[animal] || 0) + amount;
            saveToFirebase(balance - amount);

            const badge = document.getElementById('badge-' + animal);
            badge.innerText = currentBets[animal];
            badge.style.display = 'block';
        }

        function playGame() {
            const animals = ['tiger', 'rooster', 'shrimp', 'crab', 'fish', 'gourd'];
            if(Object.keys(currentBets).length === 0) return alert("กรุณาวางเดิมพันก่อน");

            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            btn.innerText = "กำลังสุ่ม...";

            setTimeout(() => {
                const winAnimal = animals[Math.floor(Math.random() * animals.length)];
                let winAmount = 0;

                if(currentBets[winAnimal]) {
                    winAmount = currentBets[winAnimal] * 6; // รางวัล 6 เท่า
                    alert("ยินดีด้วย! ผลรางวัลคือ: " + winAnimal.toUpperCase() + "\nคุณได้รับเงิน: " + winAmount);
                } else {
                    alert("เสียใจด้วย! ผลรางวัลคือ: " + winAnimal.toUpperCase());
                }

                saveToFirebase(getCurrentBalance() + winAmount);
                resetTable();
                btn.disabled = false;
                btn.innerText = "หมุนเลย!";
            }, 1200);
        }

        function resetTable() {
            currentBets = {};
            document.querySelectorAll('.bet-badge').forEach(b => {
                b.style.display = 'none';
                b.innerText = '0';
            });
        }

        // --- 4. Admin Functions ---
        function toggleAdmin() {
            const pass = prompt("กรุณาใส่รหัสผ่าน Admin:");
            if(pass === "77457017") { // รหัสเดิมจาก luckyapp.html
                const panel = document.getElementById('adminPanel');
                panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            } else {
                alert("รหัสผ่านไม่ถูกต้อง");
            }
        }

        function adminSetBalance() {
            const newBal = parseInt(document.getElementById('adminBalanceInput').value);
            if(isNaN(newBal)) return alert("กรุณาระบุจำนวนเงิน");
            saveToFirebase(newBal);
            alert("ปรับยอดเงินเรียบร้อย");
        }

        function logout() {
            if(confirm("ต้องการออกจากระบบใช่หรือไม่?")) {
                location.reload();
            }
        }
    </script>
</body>
</html>
